name: 02 - Build Compose

on:
  workflow_dispatch:

jobs:
  compose_files:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: write
    steps:
      - uses: actions/checkout@v3
        with:
          token: ${{ secrets.GH_ORG_TOKEN }}
      - run: |
          echo "${{ vars.DOCKER_USER }}" >> $GITHUB_STEP_SUMMARY
          echo "${{ vars.docker_user }}" >> $GITHUB_STEP_SUMMARY
          echo "${{ vars.docker_image }}" >> $GITHUB_STEP_SUMMARY
          echo "${{ vars.docker_tag }}" >> $GITHUB_STEP_SUMMARY
          echo "${{ vars.vhost_name }}" >> $GITHUB_STEP_SUMMARY
          echo "${{ vars.repo_name }}" >> $GITHUB_STEP_SUMMARY
          echo "${{vars.privileged }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - run: |
          echo "services:" >> docker-compose.tmp
          MYVAR=$(cat << EOF >> docker-compose.tmp
            ${{ vars.repo_name }}:
              image: ${{ vars.docker_user }}/${{ vars.docker_image}}:${{ vars.docker_tag }}
              hostname: ${{ vars.vhost_name }}
              container_name: ${{ vars.repo_name }}
          EOF)
      - run: |
          echo ${MYVAR}
   
